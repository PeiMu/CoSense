## Making changes in the Newton grammar
A step-by-step guide.

1. Project the changes in `newton.grammar`. Note that this is just a reference. It is not parsed anywhere.
2. Change the FIRST and FOLLOW sets in `newton.ffi` according to the changes. Note that these can be recursive, no need to compute the final FIRST and FOLLOW sets.
3. Run ffi generation from wirth-tools to generate the `new_autoGeneratedSets.c`. This will be copied over to `newton-ffi2code-autoGeneratedSets.c` after some changes.
    ```
    ./ffi2code-*-EN <path>/<to>/newton.ffi > new_autoGeneratedSets.c
    ```
4. **Changes in `new_autoGeneratedSets.c`.**
   1. Cut **token and production IrNode types** from `new_autoGeneratedSets.c` into `common-data-structures.h` in the designated positions of the `IrNodeType` enum.
   2. Copy-over **initial comment and definitions** from `newton-ffi2code-autoGeneratedSets.c` into `new_autoGeneratedSets.c`.
   3. Change **variable names and dimensions** in `new_autoGeneratedSets.c` so that they match those in `newton-ffi2code-autoGeneratedSets.c`.
   4. Change `astNodeMax` to `kNewtonIrNodeTypeMax` in the initializations.
   5. \* Add Zeof token after production firsts:
    ```
    [kNewtonIrNodeType_Zeof] = {kNewtonIrNodeTypeMax},
    ```
   6. \* Add first set for every token to be itself and `kNewtonIrNodeTypeMax`. For example:
    ```
    [kNewtonIrNodeType_TBernoulli] = {kNewtonIrNodeType_TBernoulli, kNewtonIrNodeTypeMax},
    [kNewtonIrNodeType_TBeta] = {kNewtonIrNodeType_TBeta, kNewtonIrNodeTypeMax},
    ... and so forth ...
    ```
   7. \* Add this in the end of `gNewtonAstNodeStrings` array.
    ```
    [kNoisyIrNodeType_Xseq] = "kNoisyIrNodeType_Xseq",
    ```
    \* These steps (v-vii) are also documented in the comments of `src/newton/newton-ffi2code-autoGeneratedSets.c`.
    
    Please also copy **all comments** over to their respective positions in `new_autoGeneratedSets.c`.

5. Copy `new_autoGeneratedSets.c` to `newton-ffi2code-autoGeneratedSets.c`.
6. Add any newly created (or remove any removed) tokens and productions to `newton-tokens.c` and `newton-productions.c`.
7. Make needed changes to the `newton-parser.c`.
8. Try to compile.

#### Related files locations:

* `src/common/common-data-structures.h`
* `src/newton/newton.ffi`
* `src/newton/newton-ffi2code-autoGeneratedSets.c`
* `src/newton/newton.grammar`
* `src/newton/newton-productions.c`
* `src/newton/newton-parser.c`
* `src/newton/newton-tokens.c`
* `submodules/wirth-tools/ffi2code-*-EN`